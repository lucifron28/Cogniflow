<div class="sidebar flex flex-col h-screen transition-all duration-300"
    [style.width.px]="isCollapsed() ? 60 : sidebarWidth()" [class.collapsed]="isCollapsed()">

    <!-- Sidebar Header -->
    <div class="sidebar-header p-4 flex items-center justify-between">
        @if (!isCollapsed()) {
        <div class="logo-container flex items-center gap-1">
            <span class="logo-bracket text-2xl font-bold text-glow">[</span>
            <app-icon name="brain" size="lg" customClass="logo-brain"></app-icon>
            <span class="logo-bracket text-2xl font-bold text-glow">]</span>
            <h2 class="text-xl font-bold text-glow ml-2">Cogniflow</h2>
        </div>
        } @else {
        <div class="logo-collapsed">
            <span class="logo-bracket-small text-lg font-bold text-glow">[</span>
            <app-icon name="brain" size="sm" customClass="logo-brain"></app-icon>
            <span class="logo-bracket-small text-lg font-bold text-glow">]</span>
        </div>
        }
        <button (click)="toggleSidebar()"
            class="hover-bg p-2 rounded hover:bg-opacity-10 transition-all cursor-pointer">
            @if (isCollapsed()) {
            <app-icon name="expand" size="lg"></app-icon>
            } @else {
            <app-icon name="collapse" size="lg"></app-icon>
            }
        </button>
    </div>

    @if (!isCollapsed()) {
    <!-- Search Button -->
    <div class="p-4">
        <button (click)="openSearchModal()"
            class="w-full btn-secondary px-4 py-3 rounded-lg text-left flex items-center gap-3 transition-all">
            <app-icon name="search" size="lg"></app-icon>
            <span class="opacity-60">Search... âŒ˜K</span>
        </button>
    </div>

    <!-- Sidebar Content -->
    <div class="sidebar-content flex-1 overflow-y-auto p-4 space-y-4">

        <!-- Files & Folders Section -->
        <div class="sidebar-section">
            <button (click)="toggleSection('files')"
                class="w-full flex items-center justify-between mb-2 opacity-80 hover:opacity-100 transition-opacity">
                <div class="flex items-center gap-2">
                    @if (showFiles()) {
                    <app-icon name="chevron-down" size="md"></app-icon>
                    } @else {
                    <app-icon name="chevron-right" size="md"></app-icon>
                    }
                    <span class="text-sm font-semibold">Files</span>
                </div>
            </button>
            @if (showFiles()) {
            <div class="pl-2">
                <app-file-tree />
            </div>
            }
        </div>

        <!-- Recent Notes Section -->
        <div class="sidebar-section">
            <button (click)="toggleSection('recent')"
                class="w-full flex items-center justify-between mb-2 opacity-80 hover:opacity-100 transition-opacity">
                <div class="flex items-center gap-2">
                    @if (showRecent()) {
                    <app-icon name="chevron-down" size="md"></app-icon>
                    } @else {
                    <app-icon name="chevron-right" size="md"></app-icon>
                    }
                    <span class="text-sm font-semibold">Recent</span>
                </div>
            </button>
            @if (showRecent()) {
            <div class="pl-4 space-y-1">
                <p class="text-sm opacity-50">Recent notes coming soon...</p>
            </div>
            }
        </div>

        <!-- Tags Section -->
        <div class="sidebar-section">
            <button (click)="toggleSection('tags')"
                class="w-full flex items-center justify-between mb-2 opacity-80 hover:opacity-100 transition-opacity">
                <div class="flex items-center gap-2">
                    @if (showTags()) {
                    <app-icon name="chevron-down" size="md"></app-icon>
                    } @else {
                    <app-icon name="chevron-right" size="md"></app-icon>
                    }
                    <span class="text-sm font-semibold">Tags</span>
                </div>
            </button>
            @if (showTags()) {
            <div class="pl-4 space-y-1">
                <p class="text-sm opacity-50">Tags coming soon...</p>
            </div>
            }
        </div>

        <!-- Tasks Preview Section -->
        <div class="sidebar-section">
            <button (click)="toggleSection('tasks')"
                class="w-full flex items-center justify-between mb-2 opacity-80 hover:opacity-100 transition-opacity">
                <div class="flex items-center gap-2">
                    @if (showTasks()) {
                    <app-icon name="chevron-down" size="md"></app-icon>
                    } @else {
                    <app-icon name="chevron-right" size="md"></app-icon>
                    }
                    <span class="text-sm font-semibold">Tasks</span>
                </div>
            </button>
            @if (showTasks()) {
            <div class="pl-4 space-y-1">
                <p class="text-sm opacity-50">Task preview coming soon...</p>
            </div>
            }
        </div>

        <!-- Navigation Links -->
        <div class="nav-section-border pt-4">
            <a routerLink="/notes" routerLinkActive="bg-opacity-20"
                class="nav-link flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-opacity-10 transition-all mb-2">
                <app-icon name="file" size="lg"></app-icon>
                <span class="text-sm">All Notes</span>
            </a>
            <a routerLink="/tasks" routerLinkActive="bg-opacity-20"
                class="nav-link flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-opacity-10 transition-all mb-2">
                <app-icon name="task" size="lg"></app-icon>
                <span class="text-sm">Tasks</span>
            </a>
            <a routerLink="/analytics" routerLinkActive="bg-opacity-20"
                class="nav-link flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-opacity-10 transition-all">
                <app-icon name="analytics" size="lg"></app-icon>
                <span class="text-sm">Analytics</span>
            </a>
        </div>
    </div>

    <!-- Sidebar Footer -->
    <div class="sidebar-footer p-4 flex items-center justify-between gap-2 relative">
        <app-theme-toggle />

        <!-- Settings Dropdown -->
        <div class="relative">
            <button (click)="toggleSettingsMenu()" class="p-2 rounded-lg transition-all duration-200 cursor-pointer"
                [ngClass]="{
                    'bg-cyber-accent/20 hover:bg-cyber-accent/30 hover:shadow-[0_0_20px_rgba(0,242,254,0.6)]': showSettings() && themeService.theme() === 'cyber-glow',
                    'hover:bg-cyber-accent/10 hover:shadow-[0_0_20px_rgba(0,242,254,0.6)]': !showSettings() && themeService.theme() === 'cyber-glow',
                    'bg-electric-neon/20 hover:bg-electric-neon/30 hover:shadow-[0_0_20px_rgba(59,130,246,0.6)]': showSettings() && themeService.theme() === 'electric-sky',
                    'hover:bg-electric-neon/10 hover:shadow-[0_0_20px_rgba(59,130,246,0.6)]': !showSettings() && themeService.theme() === 'electric-sky'
                }" [attr.aria-label]="'Settings'" [attr.aria-expanded]="showSettings()" title="Settings">
                <app-icon name="settings" size="lg"></app-icon>
            </button>

            <!-- Dropdown Menu -->
            @if (showSettings()) {
            <div class="absolute bottom-full right-0 mb-2 w-56 rounded-lg shadow-2xl overflow-hidden backdrop-blur-xl border z-50 transition-colors"
                [class.bg-cyber-darker/95]="themeService.theme() === 'cyber-glow'"
                [class.border-cyber-accent/30]="themeService.theme() === 'cyber-glow'"
                [class.bg-electric-light/95]="themeService.theme() === 'electric-sky'"
                [class.border-electric-neon/30]="themeService.theme() === 'electric-sky'"
                (click)="$event.stopPropagation()">

                <div class="px-4 py-3 border-b border-opacity-20"
                    [class.border-cyber-accent]="themeService.theme() === 'cyber-glow'"
                    [class.border-electric-neon]="themeService.theme() === 'electric-sky'">
                    <p class="text-sm font-semibold opacity-90">Settings</p>
                </div>

                <!-- Menu Items -->
                <div class="py-2">
                    <!-- Profile -->
                    <button
                        class="w-full px-4 py-2.5 text-left flex items-center gap-3 transition-all duration-200 cursor-pointer"
                        [ngClass]="{
                            'hover:bg-white/10': themeService.theme() === 'cyber-glow',
                            'hover:bg-black/10': themeService.theme() === 'electric-sky'
                        }">
                        <app-icon name="user" size="md"></app-icon>
                        <span class="text-sm">Profile</span>
                    </button>

                    <!-- Preferences -->
                    <button
                        class="w-full px-4 py-2.5 text-left flex items-center gap-3 transition-all duration-200 cursor-pointer"
                        [ngClass]="{
                            'hover:bg-white/10': themeService.theme() === 'cyber-glow',
                            'hover:bg-black/10': themeService.theme() === 'electric-sky'
                        }">
                        <app-icon name="settings" size="md"></app-icon>
                        <span class="text-sm">Preferences</span>
                    </button>

                    <!-- Account Settings -->
                    <button
                        class="w-full px-4 py-2.5 text-left flex items-center gap-3 transition-all duration-200 cursor-pointer"
                        [ngClass]="{
                            'hover:bg-white/10': themeService.theme() === 'cyber-glow',
                            'hover:bg-black/10': themeService.theme() === 'electric-sky'
                        }">
                        <app-icon name="user" size="md"></app-icon>
                        <span class="text-sm">Account Settings</span>
                    </button>

                    <!-- Divider -->
                    <div class="my-2 border-t border-opacity-20"
                        [class.border-cyber-accent]="themeService.theme() === 'cyber-glow'"
                        [class.border-electric-neon]="themeService.theme() === 'electric-sky'">
                    </div>

                    <!-- Logout with Red Background -->
                    <button (click)="logout()"
                        class="w-full px-4 py-2.5 text-left flex items-center gap-3 transition-all duration-200 bg-red-500/20 hover:bg-red-600/40 text-red-400 hover:text-red-300 font-medium cursor-pointer">
                        <app-icon name="logout" size="md"></app-icon>
                        <span class="text-sm font-semibold">Logout</span>
                    </button>
                </div>
            </div>
            }
        </div>
    </div>
    } @else {
    <!-- Collapsed Icon Menu -->
    <div class="flex-1 flex flex-col items-center gap-4 py-4">
        <button (click)="openSearchModal()" class="hover-bg p-3 rounded-lg hover:bg-opacity-10 transition-all">
            <app-icon name="search" size="lg"></app-icon>
        </button>
    </div>
    }

    <!-- Resize Handle -->
    @if (!isCollapsed()) {
    <div class="resize-handle" (mousedown)="onMouseDown($event)" [class.resizing]="isResizing()">
    </div>
    }
</div>