<div class="sidebar flex flex-col h-screen transition-all duration-300"
    [style.width.px]="isCollapsed() ? 60 : sidebarWidth()" [class.collapsed]="isCollapsed()">

    <!-- Sidebar Header -->
    <div class="sidebar-header p-4 flex items-center justify-between">
        @if (!isCollapsed()) {
        <h2 class="text-xl font-bold text-glow">Cogniflow</h2>
        }
        <button (click)="toggleSidebar()" class="hover-bg p-2 rounded hover:bg-opacity-10 transition-all">
            @if (isCollapsed()) {
            <app-icon name="expand" size="lg"></app-icon>
            } @else {
            <app-icon name="collapse" size="lg"></app-icon>
            }
        </button>
    </div>

    @if (!isCollapsed()) {
    <!-- Search Button -->
    <div class="p-4">
        <button (click)="openSearchModal()"
            class="w-full btn-secondary px-4 py-3 rounded-lg text-left flex items-center gap-3 transition-all">
            <app-icon name="search" size="lg"></app-icon>
            <span class="opacity-60">Search... âŒ˜K</span>
        </button>
    </div>

    <!-- Sidebar Content -->
    <div class="sidebar-content flex-1 overflow-y-auto p-4 space-y-4">

        <!-- Files & Folders Section -->
        <div class="sidebar-section">
            <button (click)="toggleSection('files')"
                class="w-full flex items-center justify-between mb-2 opacity-80 hover:opacity-100 transition-opacity">
                <div class="flex items-center gap-2">
                    @if (showFiles()) {
                    <app-icon name="chevron-down" size="md"></app-icon>
                    } @else {
                    <app-icon name="chevron-right" size="md"></app-icon>
                    }
                    <span class="text-sm font-semibold">Files</span>
                </div>
                <button class="hover-bg p-1 rounded hover:bg-opacity-10">
                    <app-icon name="plus" size="md"></app-icon>
                </button>
            </button>
            @if (showFiles()) {
            <div class="pl-4 space-y-1">
                <p class="text-sm opacity-50">File tree coming soon...</p>
            </div>
            }
        </div>

        <!-- Recent Notes Section -->
        <div class="sidebar-section">
            <button (click)="toggleSection('recent')"
                class="w-full flex items-center justify-between mb-2 opacity-80 hover:opacity-100 transition-opacity">
                <div class="flex items-center gap-2">
                    @if (showRecent()) {
                    <app-icon name="chevron-down" size="md"></app-icon>
                    } @else {
                    <app-icon name="chevron-right" size="md"></app-icon>
                    }
                    <span class="text-sm font-semibold">Recent</span>
                </div>
            </button>
            @if (showRecent()) {
            <div class="pl-4 space-y-1">
                <p class="text-sm opacity-50">Recent notes coming soon...</p>
            </div>
            }
        </div>

        <!-- Tags Section -->
        <div class="sidebar-section">
            <button (click)="toggleSection('tags')"
                class="w-full flex items-center justify-between mb-2 opacity-80 hover:opacity-100 transition-opacity">
                <div class="flex items-center gap-2">
                    @if (showTags()) {
                    <app-icon name="chevron-down" size="md"></app-icon>
                    } @else {
                    <app-icon name="chevron-right" size="md"></app-icon>
                    }
                    <span class="text-sm font-semibold">Tags</span>
                </div>
            </button>
            @if (showTags()) {
            <div class="pl-4 space-y-1">
                <p class="text-sm opacity-50">Tags coming soon...</p>
            </div>
            }
        </div>

        <!-- Tasks Preview Section -->
        <div class="sidebar-section">
            <button (click)="toggleSection('tasks')"
                class="w-full flex items-center justify-between mb-2 opacity-80 hover:opacity-100 transition-opacity">
                <div class="flex items-center gap-2">
                    @if (showTasks()) {
                    <app-icon name="chevron-down" size="md"></app-icon>
                    } @else {
                    <app-icon name="chevron-right" size="md"></app-icon>
                    }
                    <span class="text-sm font-semibold">Tasks</span>
                </div>
            </button>
            @if (showTasks()) {
            <div class="pl-4 space-y-1">
                <p class="text-sm opacity-50">Task preview coming soon...</p>
            </div>
            }
        </div>

        <!-- Navigation Links -->
        <div class="nav-section-border pt-4">
            <a routerLink="/tasks" routerLinkActive="bg-opacity-20"
                class="nav-link flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-opacity-10 transition-all mb-2">
                <app-icon name="task" size="lg"></app-icon>
                <span class="text-sm">Tasks</span>
            </a>
            <a routerLink="/analytics" routerLinkActive="bg-opacity-20"
                class="nav-link flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-opacity-10 transition-all">
                <app-icon name="analytics" size="lg"></app-icon>
                <span class="text-sm">Analytics</span>
            </a>
        </div>
    </div>

    <!-- Sidebar Footer -->
    <div class="sidebar-footer p-4">
        <app-theme-toggle />
    </div>
    } @else {
    <!-- Collapsed Icon Menu -->
    <div class="flex-1 flex flex-col items-center gap-4 py-4">
        <button (click)="openSearchModal()" class="hover-bg p-3 rounded-lg hover:bg-opacity-10 transition-all">
            <app-icon name="search" size="lg"></app-icon>
        </button>
    </div>
    }

    <!-- Resize Handle -->
    @if (!isCollapsed()) {
    <div class="resize-handle" (mousedown)="onMouseDown($event)" [class.resizing]="isResizing()">
    </div>
    }
</div>